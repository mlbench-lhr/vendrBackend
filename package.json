{
  "name": "express-mongo-auth",
  "version": "1.0.0",
  "description": "Minimal Node.js Express + MongoDB authentication app with JWT access and refresh tokens (refresh tokens are JWTs without persistence).",
  "main": "src/index.js",
  "scripts": {
    "start": "node src/index.js",
    "dev": "nodemon src/index.js",
    "test:smoke": "node -e '(async()=>{ const assert=require(\"assert\"); const jwtService=require(\"./src/services/jwtService\"); const auth=require(\"./src/middleware/auth\"); const run=(payload)=>{ jwtService.verifyAccess=()=>payload; const req={headers:{authorization:\"Bearer t\"}}; const res={statusCode:200,status(n){this.statusCode=n;return this;},json(b){this.body=b;return this;}}; let nextCalled=false; auth(req,res,()=>{nextCalled=true;}); return {req,res,nextCalled}; }; { const r=run({id:\"id123\",email:\"a@b.com\",role:\"user\"}); assert(r.nextCalled); assert.strictEqual(r.req.user.id,\"id123\"); } { const r=run({userId:\"uid123\",email:\"a@b.com\",role:\"user\"}); assert(r.nextCalled); assert.strictEqual(r.req.user.id,\"uid123\"); } const userController=require(\"./src/controllers/userController\"); const Vendor=require(\"./src/models/Vendor\"); const Menu=require(\"./src/models/Menu\"); const VendorHours=require(\"./src/models/VendorHours\"); const original={ exists:Vendor.exists, find:Vendor.find, menuFind:Menu.find, count:Menu.countDocuments, hoursFindOne:VendorHours.findOne }; const mkDoc=(v)=>({ ...v, toObject(){ return { ...v }; } }); const allVendors=[{_id:\"v1\",name:\"Ali\",vendor_type:\"Other\",shop_address:\"a\",profile_image:null,lat:0,lng:0},{_id:\"v2\",name:\"Food Place\",vendor_type:\"Food Vendor\",shop_address:\"b\",profile_image:null,lat:0,lng:0},{_id:\"v3\",name:\"Combo\",vendor_type:\"Food & Drinks\",shop_address:\"c\",profile_image:null,lat:0,lng:0},{_id:\"v4\",name:\"Juice Bar\",vendor_type:\"Drinks\",shop_address:\"d\",profile_image:null,lat:0,lng:0}].map(mkDoc); Vendor.exists=async (filter)=>{ const re=filter?.vendor_type; if (!(re instanceof RegExp)) return false; return allVendors.some(v=>re.test(String(v.vendor_type))); }; Vendor.find=(filter)=>{ if (filter && filter._id && filter._id.$in) { const ids=filter._id.$in.map(String); const typeRe=filter.vendor_type; const selected=allVendors.filter(v=>ids.includes(v._id)); const filtered=typeRe?selected.filter(v=>typeRe.test(v.vendor_type)):selected; return { select: async ()=>filtered }; } return { select: async ()=>[{_id:\"v2\"}] }; }; Menu.find=()=>({ select: async ()=>[{vendor_id:\"v1\"},{vendor_id:\"v2\"},{vendor_id:\"v3\"},{vendor_id:\"v4\"}] }); Menu.countDocuments=async ()=>0; VendorHours.findOne=async ()=>null; { const req={ query:{ query:\"food\", lat:\"0\", lng:\"0\", distance:\"10\" } }; const res={ statusCode:200, status(n){this.statusCode=n;return this;}, json(b){this.body=b;return this;} }; await userController.searchVendors(req,res,()=>{}); assert.strictEqual(res.statusCode,200); assert.strictEqual(res.body.success,true); assert(res.body.vendors.length>0); assert(res.body.vendors.every(v=>String(v.vendor_type).toLowerCase().includes(\"food\"))); } { const req={ query:{ query:\"food drinks\", lat:\"0\", lng:\"0\", distance:\"10\" } }; const res={ statusCode:200, status(n){this.statusCode=n;return this;}, json(b){this.body=b;return this;} }; await userController.searchVendors(req,res,()=>{}); assert.strictEqual(res.statusCode,200); assert.strictEqual(res.body.success,true); assert(res.body.vendors.length>0); assert(res.body.vendors.every(v=>!/\\bother\\b/i.test(String(v.vendor_type)))); } Vendor.exists=original.exists; Vendor.find=original.find; Menu.find=original.menuFind; Menu.countDocuments=original.count; VendorHours.findOne=original.hoursFindOne; console.log(\"ok\"); })().catch((err)=>{ console.error(err); process.exit(1); });'"
  },
  "engines": {
    "node": ">=14"
  },
  "dependencies": {
    "apple-signin-auth": "^1.7.5",
    "bcrypt": "^5.1.0",
    "cloudinary": "^1.41.3",
    "dotenv": "^16.6.1",
    "express": "^4.18.2",
    "google-auth-library": "^10.5.0",
    "joi": "^17.9.2",
    "jsonwebtoken": "^9.0.2",
    "mongoose": "^7.5.1",
    "morgan": "^1.10.0",
    "multer": "^2.0.2",
    "multer-storage-cloudinary": "^4.0.0",
    "nodemailer": "^7.0.11"
  },
  "devDependencies": {
    "@types/nodemailer": "^7.0.4",
    "nodemon": "^3.0.1"
  },
  "license": "MIT"
}
